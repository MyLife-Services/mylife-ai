<div class="widget bot" id="bot-container">
    <div class="header">Bot Legion</div>
    <div class="bot-container" id="personal-biographer">
        <div class="bot-status" id="status-personal-biographer">
            <div class="bot-icon" id="personal-biographer-icon"></div>
            <div class="bot-type" id="personal-biographer-type">Biographer Bot</div>
            <div class="bot-name" id="personal-biographer-name"><span>system-one-personal-biographer</span></div>
            <div class="bot-options-dropdown" id="personal-biographer-options"></div><!-- drop-down caret to trigger slide-down of container below -->
        </div>
        <div class="bot-options hidden">
            <!-- Bot Name -->
            <div class="input-group">
                <label for="bot_name">Biographer Name:</label>
                <input id="bot_name" name="bot_name" maxlength="256">
            </div>            <!-- Date of Birth -->
            <div class="input-group">
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob">
            </div>
            <!-- Stories vs. Interview -->
            <div class="input-group narrative">
                <div class="slider-labels">
                    <span class="left-label">more<br />story-telling</span>
                    <span class="right-label">more<br />interview</span>
                </div>
                <input type="range" id="narrative-slider" name="narrative-slider" min="0" max="100">
            </div>            
            <!-- Interests/Hobbies -->
            <div class="input-group interests">
                <label>I enjoy talking about:</label>
                <div class="checkbox-group">
                    <!-- Repeat for each interest -->
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="career" value="Career">
                        <label for="career">Work/Career</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="ideas" value="Ideas">
                        <label for="ideas">Ideas</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="art" value="Art">
                        <label for="art">Art</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="music" value="Music">
                        <label for="music">Music</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="health" value="Health">
                        <label for="health">Health</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="politics" value="Politics">
                        <label for="politics">Politics</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="family" value="Family">
                        <label for="family">Family</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="culture" value="Culture">
                        <label for="culture">Culture</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="relationships" value="Relationships">
                        <label for="relationships">Relationships</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="academics" value="Academics">
                        <label for="academics">Academic Pursuits</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="sports" value="Sports">
                        <label for="sports">Sports</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="travel" value="Travel">
                        <label for="travel">Travel</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="volunteering" value="Volunteering">
                        <label for="volunteering">Volunteering</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="tech" value="Tech">
                        <label for="tech">Tech</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="food" value="Food">
                        <label for="food">Food</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="social-justice" value="Social Justice">
                        <label for="social-justice">Social Justice</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="hobbies" value="Hobbies">
                        <label for="hobbies">Hobbies</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="business" value="Business">
                        <label for="business-market">Business</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="entertainment" value="Entertainment">
                        <label for="entertainment">Entertainment</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="philosophy" value="Philosophy">
                        <label for="philosophy">Philosophy</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="psychology" value="Psychology">
                        <label for="psychology">Psychology</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="digital-self" value="Digital Self">
                        <label for="digital-self-presence">Digital Self</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="fashion" value="Fashion">
                        <label for="fashion">Fashion</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="science" value="Science">
                        <label for="science">Science</label>
                    </div>                    
                </div>
            </div>
            <!-- Privacy Settings -->
            <div class="input-group privacy">
                <div class="slider-labels">
                    <span class="left-label">private</span>
                    <span class="right-label">public</span>
                </div>
                <input type="range" class="privacy-slider" id="privacy-slider" name="privacy-slider" min="0" max="100">
            </div>
    
            <button class="button create-bot">Create</button>
        </div>
    </div>
    <div class="bot-container" id="resume">
        <div class="bot-status" id="status-resume">
            <div class="bot-icon" id="resume-icon"></div>
            <div class="bot-type" id="resume-type">Resume Bot</div>
            <div class="bot-name" id="resume-name"></div>
            <div class="bot-options-dropdown" id="resume-options"></div><!-- drop-down caret to trigger slide-down of container below -->
        </div>
        <div class="bot-options hidden">
            <!-- Upload -->
            <div class="input-group">
                <label>Upload:</label>
            </div>
            <!-- Special skills -->
            <div class="input-group skills">
                <label>Health-bot should come equipped with:</label>
                <div class="checkbox-group">
                    <!-- Repeat for each interest -->
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="medical" value="Medical">
                        <label for="medical">General Medical</label>
                    </div>
                </div>
            </div>
            <!-- Privacy Settings -->
            <div class="input-group toggle-switch">
                <label>Privacy:</label>
                <input type="checkbox" id="privacy-toggle">
                <label for="privacy-toggle">Public/Private</label>
            </div>
    
            <button class="button create-bot">Create</button>
        </div>
    </div>    
    <div class="bot-container" id="health">
        <div class="bot-status" id="status-health">
            <div class="bot-icon" id="health-icon"></div>
            <div class="bot-type" id="health-type">Resume Bot</div>
            <div class="bot-name" id="health-name"></div>
            <div class="bot-options-dropdown" id="health-options"></div><!-- drop-down caret to trigger slide-down of container below -->
        </div>
        <div class="bot-options hidden">
            <!-- Uploads -->
            <div class="input-group">
                <label>Upload Medical:</label>
            </div>
            <!-- Skills -->
            <div class="input-group medical-skills skills">
                <label>Health-bot should come equipped with:</label>
                <div class="checkbox-group" id="health-skills">
                    <!-- Repeat for each skill -->
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="interests" id="medical" value="Medical">
                        <label for="medical">General Medical</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="nurse" id="nurse" value="Nurse">
                        <label for="nurse">Nursing Care</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="rehabilitation" id="rehabilitation" value="Rehabilitation">
                        <label for="rehabilitation">Rehabilitation</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="counsel" id="counsel" value="Counsel">
                        <label for="counsel">Counsel</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="fitness" id="fitness" value="Fitness">
                        <label for="fitness">Fitness</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="research" id="research" value="Research">
                        <label for="research">Research</label>
                    </div>
                    <div class="checkbox-group-item">
                        <input type="checkbox" name="medicine" id="medicine" value="Medicine">
                        <label for="medicine">Medicine</label>
                    </div>
                </div>
            </div>
            <!-- Privacy Settings -->
            <div class="input-group toggle-switch">
                <label>Privacy:</label>
                <input type="checkbox" id="privacy-toggle">
                <label for="privacy-toggle">Public/Private</label>
            </div>
    
            <button class="button create-bot">Create</button>
        </div>
    </div>
    <div class="bot-container" id="art">
        <div class="bot-status" id="status-art"></div>
        <div class="bot-type">Artwork Bot</div>
        <div class="bot-options hidden">
            <!-- Type of artwork -->
            <div class="input-group">
                <label>What type of artwork?</label>
                <select name="starter-questions">
                    <option value="1">Music</option>
                    <option value="2">Novel</option>
                    <option value="3">Opera</option>
                </select>
            </div>
            <!-- Privacy Settings -->
            <div class="input-group toggle-switch">
                <label>Privacy:</label>
                <input type="checkbox" id="privacy-toggle">
                <label for="privacy-toggle">Public/Private</label>
            </div>
    
            <button class="button create-bot">Create</button>
        </div>
    </div>
    <div class="bot-container" id="coding">
        <div class="bot-status" id="status-coding"></div>
        <div class="bot-type">Coding Assistant</div>
        <div class="bot-options hidden">
            <!-- Type of artwork -->
            <div class="input-group">
                <label>Coding Languages/Tech Stack?</label>
                <select name="starter-questions">
                    <option value="1">Music</option>
                    <option value="2">Novel</option>
                    <option value="3">Opera</option>
                </select>
            </div>
            <!-- Privacy Settings -->
            <div class="input-group toggle-switch">
                <label>Privacy:</label>
                <input type="checkbox" id="privacy-toggle">
                <label for="privacy-toggle">Public/Private</label>
            </div>
    
            <button class="button create-bot">Create</button>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    fetchBots();
});
document.querySelectorAll('.bot-options').forEach(options => {
    options.addEventListener('click', function(event) {
        event.stopPropagation();
    });
});
document.querySelectorAll('.bot-container').forEach(container => {
    container.addEventListener('click', function() {
        // First, close any currently open containers and rotate their dropdowns back
        document.querySelectorAll('.bot-container').forEach(otherContainer => {
            if (otherContainer !== this) {
                // Close the bot options
                var otherContent = otherContainer.querySelector('.bot-options');
                if (otherContent) {
                    otherContent.classList.remove('open');
                }
                // Rotate back the dropdowns
                var otherDropdown = otherContainer.querySelector('.bot-options-dropdown');
                if (otherDropdown) {
                    otherDropdown.classList.remove('open');
                }
            }
        });
        // Then, toggle the visibility of the clicked container's content
        var content = this.querySelector('.bot-options');
        if (content) {
            content.classList.toggle('open');
        }
        // Also toggle the dropdown rotation
        var dropdown = this.querySelector('.bot-options-dropdown');
        if (dropdown) {
            dropdown.classList.toggle('open');
        }
    });
});

async function fetchBots(){
    try {
        console.log('Fetching bots')
        const _url = window.location.origin + '/members/bots';
        console.log(_url)
        const response = await fetch(_url); // Replace with your actual endpoint
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const bots = await response.json();
        // Process and display the bots here
        updateBotContainers(bots);
    } catch (error) {
        console.log('Error fetching bots:', error);
    }
}
function getBotStatus(_bot, _botIcon){
    switch (true) {
        case (_bot?.thread_id?.length>0 || false): // activated
            console.log('getBotStatus:active', _bot, _botIcon)
            _botIcon.classList.add('active');
            _botIcon.classList.remove('inactive');
            return 'active'
        case ( _bot?.bot_id?.length>0 || false): // unactivated
             console.log('getBotStatus:inactive', _bot, _botIcon)
            _botIcon.classList.add('inactive');
            _botIcon.classList.remove('active');
            return 'inactive'
        default:
            console.log('getBotStatus:none', _bot?.bot_id, _botIcon)
            _botIcon.classList.remove('active', 'inactive');
            return 'none'
    }
}
function updateBotContainers(_bots){
	_bots.forEach(_bot => {
        const _botContainer = document.getElementById(_bot.type);
        if (_botContainer) {
            const _botStatus = _botContainer.querySelector('.bot-status');
            const _botIcon = _botStatus.querySelector('.bot-icon');
            const _botOptions = _botContainer.querySelector('.bot-options');
            const _botOptionsDropdown = _botStatus.querySelector('.bot-options-dropdown');
            // based on _bot.thread_id, check if bot is active
            _bot.status = getBotStatus(_bot, _botIcon);
        } else {
            // @todo: push to home-grown bots
        }
    });
}
</script>